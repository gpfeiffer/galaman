<h3>
  <%= link_to invitation.competition.name, invitation.competition %>
  (<%= invitation.competition.location %>, <%= invitation.competition.date %>)
</h3>

<h1><%= link_to invitation.club.name, invitation %></h1>

<h3>Results </h3>

<% invitation.registrations.group_by(&:gender).each do |gender, registrations| %>
  <% events = registrations.map(&:events).reduce(:|).sort_by(&:pos) %>
  <table class="fact-sheet">
    <tr class="times-major">
      <th>Swimmer (<%= gender.upcase %>)</th>
      <th>Age</th>
      <% events.each do |event| %>
        <th colspan="2"><%= event.discipline.nickname %></th>
      <% end %>
    </tr>
    <% registrations.sort_by { |x| x.swimmer.name }.each do |registration| %>
      <% swimmer = registration.swimmer %>
      <% entries = registration.entries.group_by(&:event) %>
      <tr class="times-major">
        <td><%= link_to swimmer.name, registration %></td>
        <td align="right"><%= registration.age %></td>
        <% events.each do |event| %>
          <td align="right">
  	    <% entry = entries[event].first if entries[event].present? %>
            <% if entry and entry.result %>
              <%= link_to entry.result, entry.result %>
              </td>
              <td>
              <%= '*' if entry.result.time > 0 and (entry.time == 0 or entry.time > entry.result.time) %>
              <% qu = entry.result.qualify %>
              <%= qu and qu[:qualification].name %>
            <% else %>
              </td>
              <td>
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </table>
  <br />
  <br />
<% end %>

<hr/>
<%= link_to 'Back', invitation %>
