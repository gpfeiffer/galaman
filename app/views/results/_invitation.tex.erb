\thispagestyle{empty}
\section*{<%= invitation.competition.name %>}
<%= invitation.competition.location %>, <%= invitation.competition.date %>
\section*{Results (<%= @invitation.club.symbol %>)}

<% invitation.registrations.group_by(&:gender).each do |gender, registrations| %>
  <% events = registrations.map(&:events).reduce(:|).sort_by(&:pos) %>
\begin{tabular}{p{4cm}<%= 'r' * events.count %>}
  \toprule
  Swimmer (<%= gender.upcase %>), Age
  <% events.each do |event| %>
    & \hbox to 18mm{}\llap{<%= event.discipline.nickname %>}
  <% end %>
  \\ \midrule
    <% registrations.sort_by { |x| x.swimmer.name }.each do |registration| %>
      <% swimmer = registration.swimmer %>
      <% entries = registration.entries.group_by(&:event) %>
  <%= raw swimmer.first_last %>, <%= registration.age %>
      <% events.each do |event| %>
  & 
  	<% entry = entries[event].first if entries[event].present? %>
        <% if entry and entry.result %>
  <%= entry.result -%>
  <% qu = entry.result.qualify %>\rlap{%
  <%= '*' if entry.result.time > 0 and (entry.time == 0 or entry.time > entry.result.time) -%>
  <%= qu and qu[:qualification].name -%>}
        <% end %>
    <% end %>
  \\
<% end %>
\bottomrule
\end{tabular}
\par
<% end %>
