<% content_for :level do %>
  <h3><%= @swimmer.club %></h3>
  <% @swimmer.club.swimmers.group_by(&:gender).each do |gender, swimmers| %>
    <h4><%= { 'f' => 'Girls', 'm' => 'Boys' }[gender] %></h4>
    <ul><%= render swimmers %></ul>
  <% end %>
<% end %>

<h3><%= link_to @swimmer.club, @swimmer.club %></h3>

<h1><%= @swimmer.first_last %></h1>

<p>
  <b>Age (F/M):</b>
  <%= "#{@swimmer.age} (#{@swimmer.gender.upcase})" %>
  [<%= @swimmer.birthday %>].
  <b>Swim Ireland ID:</b>
  <%= @swimmer.registration %>.
</p>

<% if @swimmer.user and can? :destroy, @swimmer %>
  <p>
    <code><%= @swimmer.user.email %></code>
  </p>
<% end %>

<h2>Personal Best</h2>

<p>
<b>&rsaquo; 
Click</b> on the PB time to see the full history of <%= @swimmer.first %>'s 
results in a particular stroke.
</p>

<table class="fact-sheet">
<tr class="times-major">
<th></th>
<% Discipline::STROKES.each do |stroke| %>
  <th style="width:96px"><%= truncate(stroke, :length => 12) %></th>
<% end %>
</tr>

<% @swimmer.entries.group_by(&:distance_course_code).sort.each do |row, entries_row| %>
  <% entries = entries_row.group_by(&:stroke) %>
  <tr class="pb-hi" align="right">
    <th rowspan="2"><%= distance_course(row) %></th>
    <% Discipline::STROKES.each do |stroke| %>
      <td>
        <% if entries[stroke] %>
          <% best = best_result(entries[stroke].map(&:result).compact) %>
	  <% if best %>
            <span title="<%= best.fina_points %>">
              <%= link_to best, results_path(:swimmer_id => @swimmer, :discipline_id => best.discipline), 'data-popup' => true %>
            </span>
          <% end %>
        <% end %>
      </td>
    <% end %>
  </tr>
  <tr class="pb-lo" align="right">
    <% Discipline::STROKES.each do |stroke| %>
      <td>
        <% if entries[stroke] %>
          <% best = best_result(entries[stroke].map(&:result).compact) %>
	  <% if best %>
              (<%= best.date.strftime("%d/%m/%y") %>)
            </span>
          <% end %>
        <% end %>
      </td>
    <% end %>
  </tr>
<% end %>
</table>
<br/>

<%= render 'qualifications' if can? :read, @swimmer.aims.first %>

<h2>Competitions.</h2>

<ul>
<% @swimmer.registrations.sort_by(&:date).reverse_each do |registration| %>
  <% competition = registration.competition %>
  <li>
    <%= competition.date %>: 
    <%= link_to competition.name, registration %> 
    (<%= competition.location %>)
  </li>
<% end %>
</ul>

<hr />

<% if can? :update, @swimmer %>
  <%= link_to 'Edit', edit_swimmer_path(@swimmer) %> |
<% end %>
<% if can? :destroy, @swimmer %>
  <%= link_to 'Destroy', @swimmer, :confirm => 'Are you sure?', :method => :delete  %> |
<% end %>
<%= link_to 'Back', :back %>
